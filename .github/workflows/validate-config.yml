name: âœ… Validate Configuration

on:
  pull_request:
    paths:
      - '.github/workflows/**'
      - 'vercel.json'
      - 'package.json'
      - '.env.example'
      - '.env.production'

jobs:
  validate-config:
    name: ğŸ” Validate Deployment Config
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        
      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          
      - name: ğŸ“¥ Install dependencies
        run: npm ci
        
      - name: ğŸ” Validate deployment setup
        run: |
          echo "Checking required files..."
          
          # Check required files exist
          files=("vercel.json" ".env.example" ".env.production" "DEPLOYMENT.md")
          for file in "${files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "âŒ Missing required file: $file"
              exit 1
            else
              echo "âœ… Found: $file"
            fi
          done
          
          # Validate vercel.json syntax
          echo "Validating vercel.json..."
          node -e "JSON.parse(require('fs').readFileSync('vercel.json', 'utf8'))" || exit 1
          echo "âœ… vercel.json is valid JSON"
          
          # Check if validation script exists and is executable
          if [ -f "scripts/validate-deployment.sh" ] && [ -x "scripts/validate-deployment.sh" ]; then
            echo "âœ… Deployment validation script found and executable"
          else
            echo "âŒ Deployment validation script missing or not executable"
            exit 1
          fi
          
      - name: ğŸ§ª Test build with production env
        run: |
          # Test build works with production environment
          cp .env.production .env.local
          npm run build
          rm .env.local
          
      - name: âœ… Configuration validation complete
        run: echo "ğŸ‰ All deployment configuration checks passed!"